id: modalPublicImage
namespace: blueprint
inputs:
  - name: repository
    type: STRING
    defaults: https://github.com/kestra-io/examples
  - name: branch
    type: STRING
    defaults: main

tasks:
  - id: pythonRepository
    type: io.kestra.core.tasks.flows.WorkingDirectory
    tasks:
      - id: cloneRepository
        type: io.kestra.plugin.git.Clone
        branch: "{{inputs.branch}}"
        url: "{{inputs.repository}}"

      - id: runModal
        type: io.kestra.core.tasks.scripts.Bash
        commands:
          - modal run modal-scripts/gpu.py
        dockerOptions:
          image: ghcr.io/anna-geller/python-modal:latest
        env:
          MODAL_TOKEN_ID: "{{envs.modal_token_id}}"
          MODAL_TOKEN_SECRET: "{{envs.modal_token_secret}}"
        runner: DOCKER
